---
title: "Group project - Athen Airbnbs"
author: "Group 19: Daniel Zeiner, Balint XXX, Tao XXX, Mayssa XXX, Eudald XXX"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    highlight: zenburn
    number_sections: yes
    toc: yes
    toc_float: yes
    code_folding: show
---

```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)

# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```





```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(igraph)
library(ggmap)
library(geosphere)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(mosaic)
library(ggthemes)
library(GGally)
library(skimr)


theme_set(theme_minimal())
theme_update(axis.line = element_line(colour = "#C8102E"))
theme_update(axis.text.x = element_text(colour= "#001E62",
                                 size = 10,
                                 family = "Arial"))
```

# Airbnb Project - Athens

## Introduction


## Summary of key findings




# Initial data analysis

```{r setup, include=FALSE}
# Data
athens_data <- read_csv("data/listings.csv")

glimpse(athens_data)
```

## Cleaning the data 


```{r}
skim(athens_data)
```

Based on our initial data analysis we identified 4 major types of variables in the underlying data set: 

1) Character values: 47
2) Date values: 5
3) Logical values: 15
4) Numeric values: 39

We also have seen that we have 11,314 observations (apartments) & a total of 106 data points per apartment. 


### Reducing the dataset 

We identified many variables that have a characteristic which make it either not interesting to analyze (only one/ very few distinct values, text strings) or that we think we will not use in the analysis later on. 

So we excluded these columns/ data points in order to make the data easier & faster to handle.


```{r}
athens_data_red <- athens_data %>% 
    #Select the relevant variables
  select(
         id,
         neighbourhood,
         zipcode,
         latitude,
         longitude,
         property_type,
         room_type,
         accommodates,
         bathrooms,
         bedrooms,
         beds,
         price,
         weekly_price,
         monthly_price,
         security_deposit,
         cleaning_fee,
         guests_included,
         extra_people,
         minimum_nights,
         maximum_nights,
         availability_365,
         number_of_reviews_ltm,
         review_scores_rating,
         review_scores_checkin,
         review_scores_cleanliness,
         review_scores_accuracy,
         review_scores_communication,
         review_scores_location,
         review_scores_value,
         cancellation_policy,
         reviews_per_month,
         host = host_id, 
         host_response_time,
         host_response_rate,
         host_acceptance_rate,
         host_is_superhost,
         host_listings_count,
         host_total_listings_count,
         host_identity_verified,number_of_reviews,
         host_instant_booking =  instant_bookable,
  )

```


We now only have 41 columns left, which make the data set easier to handle. 

### Adjust data values

In a next step we will adjust the type of some variables so that we can actually can work with the data more easily. 

* We transform the price, security deposit, cleaning fee, host response rate and host acceptance rate from character variables to numeric ones
* We create factor variables for Property type, room types, cancellation policy and host response time 


```{r}

# Transform character values to numeric values
athens_data_clean <- athens_data_red %>% 
   mutate(
     price = as.numeric(str_remove_all(price, "[$ ,]")),
     weekly_price = as.numeric(str_remove_all(weekly_price, "[$ , ]")),
     monthly_price = as.numeric(str_remove_all(monthly_price, "[$ ,]")),
     cleaning_fee = as.numeric(str_remove_all(cleaning_fee, "[$ ,]")),
     host_response_rate = as.numeric(str_remove_all(cleaning_fee, "[% ,]")),
     host_acceptance_rate = as.numeric(str_remove_all(cleaning_fee, "[% ,]"))
     )

# Create factor variables for room types 
room_types <- unique(athens_data_clean$room_type)
athens_data_clean$room_type <- factor(athens_data_clean$room_type, labels = room_types)

# Create factor variables for cancellation policies 
cancellation_policies <- unique(athens_data_clean$cancellation_policy)
athens_data_clean$cancellation_policy <- factor(athens_data_clean$cancellation_policy, labels = cancellation_policies)

# Create factor variables for host response time 





```




```{r setup, include=FALSE}
# Remove dollar sign and commas from the data 




athens_data <- athens_data %>% 
  mutate(price = as.numeric(str_remove_all(price, "[$ ,]")),
         weekly_price = as.numeric(str_remove_all(weekly_price, "[$ , ]")),
         monthly_price = as.numeric(str_remove_all(monthly_price, "[$ ,]")),
         cleaning_fee = as.numeric(str_remove_all(cleaning_fee, "[$ ,]")))

# Quick plot to see outliers
athens_data %>% 
  ggplot(aes(x = price)) +
  geom_histogram() +
  labs(title= "Distribution of prices in our original data")
# Looks very scewed, probably a log-normal distribution, use log -> normal

athens_data %>% 
  ggplot(aes(x = log(price))) +
  geom_histogram()

# There seem to be a few outliers. We will remove them using the IQR method, becauses we belive that keeping those values would skew our analysis
IQR.outliers <- function(x) {
  Q3 <- quantile(x,0.95)
  Q1 <- quantile(x,0.05)
  IQR <- (Q3-Q1)
  left <- (Q1-(1.5*IQR))
  right <- (Q3+(1.5*IQR))
  print(c(left, right))
  c(x[x <left],x[x>right])
}

# Print outliers
IQR.outliers(athens_data$price)

athens_data %>% 
  filter(!(price %in% IQR.outliers(athens_data$price))) %>% 
  ggplot(aes(x = log(price))) +
  geom_histogram()

# Quick model
summary(lm(as.numeric(reviews_per_month) ~ as.numeric(review_scores_rating), data = athens_data))

# Create a custom theme for our plots
theme_set(theme_minimal())
```




```{r}
# Plot our airbnbs
qmplot(longitude, latitude, data = athens_data %>% filter(!(price %in% IQR.outliers(athens_data$price))), color = price)

# City borders coordinates
athens <- c(c(38.11295, 37.878105), 
            c(23.578729, 23.901406))

# Syntagma coordinates
syntagma <- c(37.975344, 23.735511)

# Get world map
world <- ne_countries(scale = "medium", returnclass = "sf", country="greece")

openmap(c(23.578729, 23.901406),
        c(38.11295, 37.878105),
        type = "nps")

plot(AustraliaMap)

# Calculate distance between coordinates
distm(c(lon1, lat1), c(lon2, lat2), 
      fun = distHaversine)

# THis is not working
ggplot(data = world) +
    geom_sf() +
    geom_point(data = athens_data, aes(x = longitude, y = latitude), size = 4, 
        shape = 23, fill = "darkred")  +
    coord_sf(xlim = c(23.578729, 23.901406), 
             ylim = c(37.878105, 38.11295), 
             expand = FALSE)



```

